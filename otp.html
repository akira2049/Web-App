<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>OTP Verification</title>
  <link rel="stylesheet" href="transfer.css">
  <style>
    .center{max-width:520px;margin:48px auto}
    .otp-box{display:flex;gap:10px;justify-content:center;margin:16px 0 8px}
    .otp-input{width:56px;height:56px;text-align:center;font-size:22px;border:1.5px solid var(--border);border-radius:12px}
    .small{color:var(--muted);text-align:center}
    .row-aux{display:flex;justify-content:space-between;align-items:center;margin:8px 0 18px}
    .timer{color:var(--muted)}
    .btn.full{width:100%}
    .linkish{cursor:pointer}
  </style>
</head>
<body>
  <div class="app center card">
    <div class="section">
      <div class="h1" style="margin-bottom:6px">OTP Verification</div>
      <div class="small">Enter the verification code sent to your registered phone number <span id="msk">**********</span></div>

      <div class="otp-box" id="box">
        <input class="otp-input" maxlength="1" inputmode="numeric" />
        <input class="otp-input" maxlength="1" inputmode="numeric" />
        <input class="otp-input" maxlength="1" inputmode="numeric" />
        <input class="otp-input" maxlength="1" inputmode="numeric" />
        <input class="otp-input" maxlength="1" inputmode="numeric" />
        <input class="otp-input" maxlength="1" inputmode="numeric" />
      </div>

      <div class="row-aux">
        <span class="linkish" id="resend">Resend code</span>
        <span class="timer" id="count">01:30</span>
      </div>

      <button class="btn full" id="submit" disabled>Submit</button>
      <div class="small" style="margin-top:8px">Demo code: <b>123456</b></div>
    </div>
  </div>

<script>
  const inputs = [...document.querySelectorAll('.otp-input')];
  const submit = document.getElementById('submit');
  const count = document.getElementById('count');
  const resend = document.getElementById('resend');
  const msisdn = localStorage.getItem('re_msisdn') || '016******91';
  document.getElementById('msk').textContent = mask(msisdn);

  function mask(n){
    const last2 = n.replace(/[^0-9]/g,'').slice(-2);
    return (n.slice(0,3) || '***') + '******' + last2;
  }

  // move focus
  inputs.forEach((el, i)=>{
    el.addEventListener('input', ()=>{
      el.value = el.value.replace(/\D/g,'');
      if(el.value && i < inputs.length-1) inputs[i+1].focus();
      validate();
    });
    el.addEventListener('keydown', (e)=>{
      if(e.key==='Backspace' && !el.value && i>0) inputs[i-1].focus();
    });
  });

  function validate(){
    const code = inputs.map(x=>x.value).join('');
    submit.disabled = code.length!==6;
  }

  function timer(sec){
    let t = sec;
    const tick = ()=>{
      const m = String(Math.floor(t/60)).padStart(2,'0');
      const s = String(t%60).padStart(2,'0');
      count.textContent = `${m}:${s}`;
      if(t>0){ t--; setTimeout(tick, 1000); }
    };
    tick();
  }
  timer(90);

  resend.addEventListener('click', ()=>{
    timer(90);
    inputs.forEach(i=>i.value='');
    inputs[0].focus();
    validate();
    alert('Demo: a new OTP "123456" would be sent.');
  });

  submit.addEventListener('click', ()=>{
    const code = inputs.map(x=>x.value).join('');
    if(code === '123456'){
      // mark verified and move to success
      localStorage.setItem('re_verified','1');
      location.href = 'recharge-success.html';
    }else{
      alert('Incorrect code. Try 123456 for demo.');
    }
  });

  inputs[0].focus();
</script>
</body>
</html>
